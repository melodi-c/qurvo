---
name: issue-planner
description: "Сканирует кодовую базу по произвольному промпту и создаёт атомарные GitHub issues, готовые к выполнению issue-executor. Вызов: /issue-planner <что искать>"
disable-model-invocation: true
---

# Issue Planner — Сканер и Создатель GitHub Issues

**РОЛЬ**: Ты — аналитик кодовой базы. Получаешь промпт, тщательно исследуешь код, выявляешь конкретные задачи и создаёшь атомарные GitHub issues в формате проекта.

---

## Шаг 1: Получить промпт

Аргументы при вызове — задача/область для сканирования.

Если аргументов нет — спроси:
> Что нужно проанализировать? Примеры:
> - `найди все UX проблемы в web`
> - `найди N+1 запросы в API`
> - `accessibility audit: aria-labels, семантика`
> - `найди устаревшие паттерны для рефакторинга`
> - `найди потенциальные security проблемы`

---

## Шаг 2: Изучить контекст

Прочитай CLAUDE.md в корне и в релевантных приложениях (на основе промпта).

Получи список уже открытых issues чтобы не дублировать:
```bash
gh issue list --state open --json number,title --limit 50
```

---

## Шаг 3: Исследовать кодовую базу

На основе промпта определи какие директории/файлы релевантны. Используй Bash, Grep, Glob, Read.

**Правило**: Не останавливайся после первой находки. Просмотри все файлы в охвате — чем полнее сканирование, тем лучше список issues.

---

## Шаг 4: Сформировать черновики issues

### Правила:

- **Атомарность**: 1 issue = 1 конкретная задача, выполнимая независимо одним агентом
- **Конкретность**: указывай точные файлы и строки (`apps/web/src/foo.tsx:42`), что именно делать
- **Группировка мелочей**: несколько тривиальных связанных задач в одном модуле — объединяй в 1 issue (с пронумерованным списком подзадач внутри)
- **Зависимости**: если issue B зависит от A — добавь в тело B `Depends on: #PLACEHOLDER-A`, заменишь на реальный номер при создании
- **Не дублируй**: если похожая задача уже есть в открытых issues — пропусти

### Формат каждого issue:

**Заголовок**: `type(scope): краткое описание`
- `type`: `fix` / `feat` / `refactor` / `perf` / `docs` / `test` / `chore`
- `scope`: `web` / `api` / `ingest` / `processor` / `db` / `clickhouse` / `sdk` / конкретный модуль

**Тело**:
```
## Описание

[Подробное описание. Конкретные файлы со строками. Что именно изменить.
Для сгруппированных задач — нумерованный список.]

## Зависимости
Depends on: #NUMBER   ← только при реальной зависимости

## Приоритет
P1 / P2 / P3
```

Приоритет:
- **P1** — критично (баг, security, блокирует работу)
- **P2** — важно (заметно ухудшает UX или перформанс)
- **P3** — улучшение (рефакторинг, мелкие недочёты)

**Labels** (из существующих в проекте):
`bug`, `enhancement`, `refactor`, `ux/ui`, `architecture`, `web`, `api`, `security`, `billing`, `ai`, `i18n`, `good first issue`

---

## Шаг 5: Показать preview и получить подтверждение

```
Найдено N задач. Предлагаемые issues:

── 1 ──────────────────────────────────────────
Заголовок: fix(web): ...
Labels:    web, ux/ui
Приоритет: P2
Файлы: apps/web/src/foo.tsx:42

Краткое описание...

── 2 ──────────────────────────────────────────
Заголовок: refactor(api): ...
Labels:    api, refactor
Приоритет: P3
Depends on: issue 1

Краткое описание...

────────────────────────────────────────────────
Создать N issues в GitHub? (да / нет / редактировать)
```

**Дождись ответа:**
- `нет` → остановись
- `редактировать` → обсуди правки, покажи обновлённый список
- `да` → Шаг 6

---

## Шаг 6: Создать issues в GitHub

Создавай **последовательно** (чтобы отслеживать реальные номера для зависимостей).

```bash
gh issue create \
  --title "type(scope): описание" \
  --body "$(cat <<'BODY'
## Описание

...

## Приоритет
P2
BODY
)" \
  --label "web,ux/ui"
```

После создания каждого issue — сохрани его номер. Если следующий issue имел `Depends on: #PLACEHOLDER-X` — замени на реальный номер перед созданием.

---

## Шаг 7: Итоговый отчёт

```
=== Создано N issues ===

✓ #56 — fix(web): ...          [web, ux/ui]    P2
✓ #57 — refactor(api): ...     [api, refactor] P3  (depends on #56)

Для выполнения запусти:
  /issue-executor --label web
  /issue-executor 56 57
```
